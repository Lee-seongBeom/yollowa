<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.proj.yollowa.model.mypage.MypageDao">
	<select id="userDetail" resultType="com.proj.yollowa.model.entity.UserVo">
		select * from user where user_number=#{user_number}
	</select>
	<!--select * from lreservinfo where LReservInfo_userNumber=24 and LReservInfo_acticleNumber=1 and LReservInfo_cartStatus=0 and LReservInfo_reservStatus=1 and date(LReservInfo_checkIn)<date(now()) and date(LReservInfo_checkOut)<=date(now()); 
	이용내역-->
	<!--select * from lreservinfo where LReservInfo_userNumber=24 and LReservInfo_acticleNumber=1 and LReservInfo_cartStatus=0 and LReservInfo_reservStatus=1 and date(LReservInfo_checkIn)>=date(now()) and date(LReservInfo_checkOut)>date(now());
	예약현황-->
	
	<!--SELECT * FROM LRESERVINFO WHERE LRESERVINFO_USERNUMBER=24 AND LRESERVINFO_RESERVSTATUS=0 AND LRESERVINFO_CARTSTATUS=1 and date(LReservInfo_checkIn)>=date(now()) and date(lreservinfo_checkOut)>date(now()); 장바구니-->
	<select id="getLreservationInfo" resultType="com.proj.yollowa.model.entity.mypage.LReservInfoDto">
		<![CDATA[
		SELECT *
		FROM ROOMINFO AS RI JOIN LRESERVINFO LI JOIN LODGEMENT AS L ON(LI.LRESERVINFO_ROOMNUMBER=RI.ROOMINFO_ROOMNUMBER AND LI.LRESERVINFO_ACTICLENUMBER=L.LODGEMENT_NUMBER)
		WHERE RI.ROOMINFO_ARTICLENUMBER=LI.LRESERVINFO_ACTICLENUMBER
		AND RI.ROOMINFO_ROOMNUMBER=LI.LRESERVINFO_ROOMNUMBER
        AND LI.LRESERVINFO_USERNUMBER=#{USER_NUMBER}
		AND LI.LRESERVINFO_CARTSTATUS=0
		AND LI.LRESERVINFO_RESERVSTATUS=1
		AND DATE(LI.LRESERVINFO_CHECKIN)>=DATE(NOW()) 
		AND DATE(LI.LRESERVINFO_CHECKOUT)>DATE(NOW())
		ORDER BY LI.LRESERVINFO_RESERVDATE DESC;
		]]>
	</select>
	<select id="getLuserCompletedInfo" resultType="com.proj.yollowa.model.entity.mypage.LReservInfoDto">
		<![CDATA[
		SELECT *
		FROM ROOMINFO AS RI JOIN LRESERVINFO LI JOIN LODGEMENT AS L ON(LI.LRESERVINFO_ROOMNUMBER=RI.ROOMINFO_ROOMNUMBER AND LI.LRESERVINFO_ACTICLENUMBER=L.LODGEMENT_NUMBER)
		WHERE RI.ROOMINFO_ARTICLENUMBER=LI.LRESERVINFO_ACTICLENUMBER
		AND RI.ROOMINFO_ROOMNUMBER=LI.LRESERVINFO_ROOMNUMBER
        AND LI.LRESERVINFO_USERNUMBER=#{USER_NUMBER}
		AND LI.LRESERVINFO_CARTSTATUS=0
		AND LI.LRESERVINFO_RESERVSTATUS=1
		AND DATE(LI.LRESERVINFO_CHECKIN)<DATE(NOW()) 
		AND DATE(LI.LRESERVINFO_CHECKOUT)<=DATE(NOW())
		ORDER BY LI.LRESERVINFO_RESERVDATE DESC;
		]]>
	</select>
	<select id="getLuserCartInfo" resultType="com.proj.yollowa.model.entity.mypage.LReservInfoDto">
		<![CDATA[
		SELECT *
		FROM ROOMINFO AS RI JOIN LRESERVINFO LI JOIN LODGEMENT AS L ON(LI.LRESERVINFO_ROOMNUMBER=RI.ROOMINFO_ROOMNUMBER AND LI.LRESERVINFO_ACTICLENUMBER=L.LODGEMENT_NUMBER)
		WHERE RI.ROOMINFO_ARTICLENUMBER=LI.LRESERVINFO_ACTICLENUMBER
		AND RI.ROOMINFO_ROOMNUMBER=LI.LRESERVINFO_ROOMNUMBER
        AND LI.LRESERVINFO_USERNUMBER=#{USER_NUMBER}
		AND LI.LRESERVINFO_RESERVSTATUS=0 
		AND LI.LRESERVINFO_CARTSTATUS=1 
		AND DATE(LI.LRESERVINFO_CHECKIN)>=DATE(NOW()) 
		AND DATE(LI.LRESERVINFO_CHECKOUT)>DATE(NOW())
		ORDER BY LI.LRESERVINFO_RESERVDATE DESC;	
		]]>
	</select>
	<select id="getUserWishList" resultType="com.proj.yollowa.model.entity.lodgement.LodgementVo">
		SELECT *
		FROM LODGEMENT
		WHERE LODGEMENT_NUMBER=#{USER_WISHLIST}
	</select>
	<select id="getAwishList" resultType="com.proj.yollowa.model.entity.activity.ActivityVo">
		select * from activity
		where activity_number=#{activity_number}
	</select>
	<select id="getLwishList" resultType="com.proj.yollowa.model.entity.lodgement.LodgementVo">
		select * from lodgement
		where lodgement_number=#{lodgement_number}
	</select>
	<select id="getReviewInfo" resultType="com.proj.yollowa.model.entity.mypage.ReviewDto">
		SELECT * FROM LRESERVINFO AS LI JOIN LODGEMENT AS L JOIN ROOMINFO AS RI ON(LI.LRESERVINFO_ACTICLENUMBER=L.LODGEMENT_NUMBER AND LI.LRESERVINFO_ACTICLENUMBER=RI.ROOMINFO_ARTICLENUMBER)
		WHERE LI.LRESERVINFO_ROOMNUMBER=RI.ROOMINFO_ROOMNUMBER
		AND LI.LRESERVINFO_NUMBER=#{LODGEMENT_NUMBER}
	</select>
	<insert id="insertReview" parameterType="com.proj.yollowa.model.entity.ReviewVo">
		INSERT INTO review (review_articleNumber, review_title, review_userNumber, review_reservNumber, review_category, review_starPoint, review_writedDate, review_content, review_writer)
		 VALUES (#{review.review_articleNumber}, #{review.review_title}, #{user_Number}, #{review.review_reservNumber}, #{review.review_category}, #{review.review_starPoint}, now(), #{review.review_content}, #{review.review_writer});
	</insert>
	<select id="getReviewCount" resultType="int">
		select count(*) from review where review_articleNumber=#{review_articleNumber}
	</select>
	<select id="getStarPoint" resultType="int">
		select review_starPoint from review where review_articleNumber=#{review_articleNumber}
	</select>
	<update id="updateReviewInfo" parameterType="com.proj.yollowa.model.entity.ReviewVo">
		UPDATE lodgement SET lodgement_reviewGradeRate =#{reviewGradeRate}, lodgement_reviewCount =#{reviewCount} WHERE lodgement_number = #{review_articleNumber}
		
	</update>
</mapper>
